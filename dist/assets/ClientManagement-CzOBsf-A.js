import{u as he,j as e,s as L,z as y}from"./admin-BluF8pBz.js";import{u as be,c as fe,r as i}from"./router-C-JlvvJt.js";import{R as z,a as q,b as K,c as ye,d as _e,e as we,f as je,g as Ne,h as ve,i as $e,j as Se,k as De,l as Ce,m as ke,n as Pe}from"./index-Dfj_MLPr.js";import{A as Ae}from"./AgentDetailsView-CHbIaDAZ.js";import{a as Je,C as Xe,O as Ye,T as Ze}from"./AgentDetailsView-CHbIaDAZ.js";import"./vendor-DJG_os-6.js";import"./icons-Cy3jFTXJ.js";const Q=[{id:"starter",name:"Starter",apiKey:"Starter Plan",description:"Perfect for small businesses",maxAgents:1,aiEmployees:1,price:"$49/mo"},{id:"professional",name:"Professional",apiKey:"Professional Plan",description:"For Growing Teams & Small Businesses",maxAgents:5,aiEmployees:5,price:"$149/mo"},{id:"business",name:"Business",apiKey:"Business Plan",description:"For Scaling Companies & Mid-Sized Teams",maxAgents:15,aiEmployees:15,price:"$299/mo"},{id:"custom",name:"Custom",apiKey:"Custom Plan",description:"For Large Organizations & Enterprises",maxAgents:999,aiEmployees:999,price:"Custom"}],Ge=()=>{const{theme:Ee,currentTheme:a}=he(),u=be(),x=fe(),G=()=>new URLSearchParams(x.search).get("tab")||"all",[_,W]=i.useState(""),[p,H]=i.useState(""),[m,J]=i.useState(G()),[w,T]=i.useState(null),[R,A]=i.useState("list"),[Le,B]=i.useState(null),[I,X]=i.useState(null),[h,O]=i.useState([]),[Y,Z]=i.useState({all:0,newlySignup:0,pending:0,onboarded:0,approved:0,rejected:0}),[ee,j]=i.useState(!0),[Te,Re]=i.useState(!1),[Be,N]=i.useState(null),[Ie,M]=i.useState(!1),[Oe,se]=i.useState(!1),[Me,Fe]=i.useState(""),[l,v]=i.useState(1),[$]=i.useState(10),[S,ae]=i.useState(0),[g,te]=i.useState(0),[c,ne]=i.useState(null),oe=i.useRef(new Set),E=i.useRef(!1);i.useEffect(()=>{const s=new URLSearchParams(x.search);if(s.get("tab")!==m){m==="all"?s.delete("tab"):s.set("tab",m);const t=s.toString(),r=t?`${x.pathname}?${t}`:x.pathname;u(r,{replace:!0})}},[m,x.pathname,x.search,u]),i.useEffect(()=>{const s=n=>{n.target.closest("[data-industry-dropdown]")||(console.log("Clicking outside industry dropdown"),se(!1))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),i.useEffect(()=>{const s=setTimeout(()=>{_!==p&&(H(_),v(1))},500);return()=>clearTimeout(s)},[_,p]),i.useEffect(()=>{v(1)},[m]);const ie=s=>{const n={page:l,limit:$};switch(s){case"all":return n;case"newlySignup":return{...n,isVerified:!1};case"pending":return{...n,isVerified:!0,isOnboarded:!1};case"onboarded":return{...n,isVerified:!0,isOnboarded:!0};case"approved":return{...n,onboardingStatus:"approved"};case"rejected":return{...n,onboardingStatus:"rejected"};default:return n}},F=async(s=m,n=l)=>{if(E.current){console.log("â­ï¸ Skipping fetch - already in progress");return}try{E.current=!0,j(!0),N(null),oe.current.add(s);const t=ie(s);console.log(`ðŸ“¡ Fetching data for tab: ${s} with params:`,t);const r=await L.get("/v1/users",t);console.log(`âœ… Raw response for ${s}:`,r),console.log("âœ… Response data:",r.data);const d=r.data||r,C=d?.data?.users||d?.users||d||[],k=d?.meta||{},P=d?.data?.meta?.pagination||k?.pagination||{};console.log(`ðŸ“Š Extracted users (${C.length}):`,C.length>0?C.slice(0,2):"No users"),console.log("ðŸ“Š Meta data:",k),console.log("ðŸ“Š Pagination data:",P);const xe=C.map(o=>({_id:o?.id||o?._id,onBoardingId:o?.onboarding?._id||null,userData:o,company_basics:{name:o?.onboarding?.company_name||o?.fullName||"Unknown",company_email:o?.onboarding?.company_email||o?.email,company_size:o?.onboarding?.address||o?.address||"Unknown",industry:[o?.onboarding?.region||"Not specified"]},plan_details:{type:o?.userData?.onboarding?.plan_type||o?.onboarding?.plan_type||o?.plan_type||"Selected",ai_employee_limit:o?.onboarding?.ai_employee_count||o?.ai_employee_count||1,monthly_price:(()=>{const V=o?.userData?.onboarding?.plan_type||o?.onboarding?.plan_type,f=Q.find(ue=>ue.apiKey===V);return f?.price==="Custom"?0:parseFloat(f?.price?.replace(/[$\/mo,]/g,"")||"0")})()},ai_employees:o?.onboarding?.ai_employees||Array.from({length:o?.onboarding?.ai_employee_count||0},(V,f)=>({id:`ai_${f+1}`,name:`AI Employee ${f+1}`,type:"Assistant",status:"Active"})),isOnBoarded:o?.isOnBoarded||!1,isApproved:o?.isApproved||!1,createdAt:o?.createdAt,lastLoginAt:o?.lastLoginAt,knowledge_sources:{website_url:o?.onboarding?.website_url||"",social_links:{linkedin:o?.onboarding?.linkedin||""},faqs_text:o?.onboarding?.faqs_text||"",uploaded_files:o?.onboarding?.uploaded_files||[]},deployment_targets:{channels:o?.onboarding?.channels||[]},instructions:{dos_and_donts:o?.onboarding?.dos_and_donts||"",fallback_contacts:o?.onboarding?.fallback_contacts||""},targets:{success_goals:o?.onboarding?.success_goals||"",success_metrics:o?.onboarding?.success_metrics||""}}));O(xe),ne(P);const b=P.total||k.total,ge=P.totalPages||k.totalPages;b!==void 0&&(ae(b),te(ge||Math.ceil(b/$)),Z(o=>({...o,[s]:b})),console.log(`âœ… Set count for ${s}:`,b))}catch(t){console.error("âŒ Error fetching data:",t),N(t.message),O([])}finally{j(!1),E.current=!1}};i.useEffect(()=>{F()},[m,l]),i.useMemo(()=>{let s=h;return p&&(s=h.filter(n=>{const t=p.toLowerCase();return n.company_basics?.name?.toLowerCase().includes(t)||n.company_basics?.company_email?.toLowerCase().includes(t)||n.userData?.fullName?.toLowerCase().includes(t)||n.userData?.email?.toLowerCase().includes(t)})),s},[h,p]);const U=i.useMemo(()=>h,[h]),D=s=>Y[s]||0,re=()=>{l>1&&v(s=>s-1)},le=()=>{l<g&&v(s=>s+1)},de=async s=>{try{if(console.log("ðŸ” handleEditClient called with client:",s),j(!0),T(s),s?.id){console.log(`ðŸš€ Fetching onboarding data for user: ${s.id}`);const n=await L.getOnboardingByUserId(s.id);console.log("âœ… Onboarding data response:",n);let t=s;n?.data?t={...s,onboardingDetails:n.data}:t={...s,onboardingDetails:{onboarding:null}};const r={_id:t._id,company_basics:{name:t?.onboardingDetails?.onboarding?.company_basics?.name||t?.company_basics?.name||"",description:t?.onboardingDetails?.onboarding?.company_basics?.description||t?.company_basics?.description||"",company_email:t?.onboardingDetails?.onboarding?.company_basics?.company_email||t?.company_basics?.company_email||"",company_phone:t?.onboardingDetails?.onboarding?.company_basics?.company_phone||t?.company_basics?.company_phone||"",website:t?.onboardingDetails?.onboarding?.company_basics?.website||t?.company_basics?.website||"",address:t?.onboardingDetails?.onboarding?.company_basics?.address||t?.company_basics?.address||"",company_size:t?.onboardingDetails?.onboarding?.company_basics?.company_size||t?.company_basics?.company_size||"",industry:t?.onboardingDetails?.onboarding?.company_basics?.industry||t?.company_basics?.industry||[],linkedin_profile:t?.onboardingDetails?.onboarding?.company_basics?.linkedin_profile||t?.company_basics?.linkedin_profile||"",primary_region:{countries:t?.onboardingDetails?.onboarding?.company_basics?.primary_region?.countries||[],states:t?.onboardingDetails?.onboarding?.company_basics?.primary_region?.states||[],cities:t?.onboardingDetails?.onboarding?.company_basics?.primary_region?.cities||[]}},ai_employees:(t?.onboardingDetails?.onboarding?.ai_employees||t?.ai_employees||[]).map(d=>({...d,knowledge_sources:{faqs_text:d?.knowledge_sources?.faqs_text||"",uploaded_files:d?.knowledge_sources?.uploaded_files||[],website_url:d?.knowledge_sources?.website_url||"",social_links:d?.knowledge_sources?.social_links||{},additional_sources:Array.isArray(d?.knowledge_sources)?d.knowledge_sources:d?.knowledge_sources?.additional_sources||[]}})),plan_details:t?.onboardingDetails?.onboarding?.plan_details||t?.plan_details||{},deployment_targets:t?.onboardingDetails?.onboarding?.deployment_targets||t?.deployment_targets||{},deployment_service:t?.onboardingDetails?.onboarding?.deployment_service||t?.deployment_service||{},consent_options:t?.onboardingDetails?.onboarding?.consent_options||t?.consent_options||{},instructions:t?.onboardingDetails?.onboarding?.instructions||t?.instructions||{},targets:t?.onboardingDetails?.onboarding?.targets||t?.targets||{},userData:t?.userData};B(r),A("edit"),M(!1)}else console.error("âŒ No client._id available:",s),N("Client ID not found")}catch(n){console.error("âŒ Error fetching onboarding data:",n),N(`Failed to fetch client data: ${n.message}`)}finally{j(!1)}},ce=async s=>{try{const n=s?.id,t=s?.fullName||s?.name||"this client";if(console.log(`ðŸ—‘ï¸ Deleting client: ${t} (ID: ${n})`),!n){y.error("Client ID not found");return}const r=await L.deleteUser(n);r?.success?(y.success("Client deleted successfully"),await F(m,l)):y.error(r?.message||"Failed to delete client")}catch(n){console.error("âŒ Error deleting client:",n),y.error("Failed to delete client")}},me=()=>{T(null),A("list"),B(null),M(!1),X(null)},pe=async s=>{try{console.log("ðŸ” handleViewClient called with client:",s),u(`/dashboard/clients/${s?.id||s?._id}`,{state:{client:s}})}catch(n){console.error("âŒ Error navigating to client details:",n),y.error("Failed to navigate to client details")}};return R==="agentView"&&I?e.jsx(Ae,{agent:I,onBack:me,currentTheme:a}):R==="details"&&w?(u(`/dashboard/clients/${w._id||w.userData?._id}`,{state:{client:w}}),A("list"),null):e.jsxs("div",{className:"space-y-4 md:space-y-6 px-2 sm:px-0",children:[e.jsx("div",{className:"relative -mx-2 sm:mx-0",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4 overflow-x-auto scrollbar-hide px-2 sm:px-0 snap-x snap-mandatory sm:grid sm:grid-cols-3",children:[e.jsx("div",{className:`${a.cardBg} border ${a.border} rounded-lg p-3 sm:p-4 shadow-sm min-w-[240px] sm:min-w-0 snap-center flex-shrink-0`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-lg ${a.searchBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(z,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.textSecondary}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:`text-xs ${a.textSecondary} font-medium`,children:"All Clients"}),e.jsx("span",{className:"text-xs font-medium text-blue-500",children:"Total"})]}),e.jsx("h3",{className:`text-xl sm:text-2xl font-semibold ${a.text}`,children:c?.total||S||D("all")}),c&&e.jsxs("p",{className:`text-xs ${a.textSecondary}`,children:["Page ",c.page||l," of ",c.totalPages||g]})]})]})}),e.jsx("div",{className:`${a.cardBg} border ${a.border} rounded-lg p-3 sm:p-4 shadow-sm min-w-[240px] sm:min-w-0 snap-center flex-shrink-0`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-lg ${a.searchBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(q,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.textSecondary}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:`text-xs ${a.textSecondary} font-medium`,children:"Awaiting Review"}),e.jsx("span",{className:"text-xs font-medium text-yellow-500",children:"Pending"})]}),e.jsx("h3",{className:`text-xl sm:text-2xl font-semibold ${a.text}`,children:D("pending")})]})]})}),e.jsx("div",{className:`${a.cardBg} border ${a.border} rounded-lg p-3 sm:p-4 shadow-sm min-w-[240px] sm:min-w-0 snap-center flex-shrink-0`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-lg ${a.searchBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(K,{className:`w-4 h-4 sm:w-5 sm:h-5 ${a.textSecondary}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:`text-xs ${a.textSecondary} font-medium`,children:"Approved Clients"}),e.jsx("span",{className:"text-xs font-medium text-green-500",children:"Active"})]}),e.jsx("h3",{className:`text-xl sm:text-2xl font-semibold ${a.text}`,children:D("approved")})]})]})})]})}),e.jsxs("div",{className:`${a.cardBg} border ${a.border} rounded-lg p-3 sm:p-4 md:p-6 shadow-lg`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 md:gap-4 mb-4 md:mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:`text-lg md:text-xl font-semibold ${a.text} flex items-center gap-2`,children:[e.jsx(z,{className:"w-4 h-4 md:w-5 md:h-5"}),"Client Requests"]}),e.jsxs("p",{className:`${a.textSecondary} text-xs md:text-sm mt-1`,children:["(",c?.total||S||D("all")," total)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:`p-2 rounded-lg ${a.hover} ${a.text} transition-all duration-200 flex-shrink-0`,title:"Refresh data",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative flex-1 sm:flex-none",children:[e.jsx(_e,{className:`absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 ${a.textSecondary}`}),e.jsx("input",{type:"text",placeholder:"Search...",value:_,onChange:s=>W(s.target.value),className:`w-full sm:w-48 md:w-64 pl-10 sm:pl-9 pr-3 py-2 text-sm rounded-lg border ${a.border} ${a.bg} ${a.text} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]})]})]}),e.jsx("div",{className:`flex gap-1 mb-4 md:mb-6 border-b ${a.border} overflow-x-auto scrollbar-hide -mx-3 sm:mx-0 px-3 sm:px-0`,children:["all","newlySignup","pending","onboarded","approved","rejected"].map(s=>{const n={all:{icon:ve,label:"All"},newlySignup:{icon:Ne,label:"Newly Signup"},pending:{icon:q,label:"Pending"},onboarded:{icon:K,label:"Onboarded"},approved:{icon:je,label:"Approved"},rejected:{icon:we,label:"Rejected"}},{icon:t,label:r}=n[s];return e.jsx("button",{onClick:()=>J(s),className:`flex-shrink-0 px-3 md:px-4 py-2 md:py-3 text-sm md:text-base font-medium transition-all duration-200 border-b-2 whitespace-nowrap ${m===s?`${a.activeBorder} ${a.text}`:`border-transparent ${a.textSecondary} ${a.hover}`}`,children:e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[e.jsx(t,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"text-sm md:text-base",children:r})]})},s)})}),e.jsx("div",{className:"space-y-3 md:space-y-4",children:ee?e.jsxs("div",{className:`text-center py-12 md:py-16 rounded-lg ${a.cardBg} border ${a.border}`,children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 md:h-12 md:w-12 border-b-2 border-blue-500 mx-auto mb-3"}),e.jsx("h3",{className:`text-base md:text-lg font-semibold ${a.text} mb-2`,children:"Loading clients..."}),e.jsx("p",{className:`text-sm ${a.textSecondary}`,children:"Please wait while we fetch the data"})]}):U.length===0?e.jsxs("div",{className:`text-center py-8 md:py-12 rounded-lg ${a.cardBg} border ${a.border}`,children:[e.jsx($e,{className:`w-10 h-10 md:w-12 md:h-12 mx-auto mb-2 md:mb-3 ${a.textSecondary}`}),e.jsx("h3",{className:`text-base md:text-lg font-semibold ${a.text} mb-1 md:mb-2`,children:p?"No matching clients":"No client requests yet"}),e.jsx("p",{className:`text-sm ${a.textSecondary}`,children:p?"Try adjusting your search criteria":"No client requests available"})]}):U?.map(s=>e.jsxs("div",{className:`${a.cardBg} border ${a.border} rounded-lg p-3 md:p-4 hover:shadow-md transition-all duration-200`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 md:mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-9 h-9 md:w-10 md:h-10 rounded-lg ${a.activeBg} flex items-center justify-center flex-shrink-0`,children:e.jsx(Se,{className:`w-4 h-4 md:w-5 md:h-5 ${a.text}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold ${a.text} text-base md:text-lg truncate`,children:s?.userData?.fullName||s?.company_basics?.name||"Unknown"}),e.jsx("p",{className:`text-xs md:text-sm ${a.textSecondary} truncate`,children:s?.userData?.email||s?.company_basics?.company_email||"No email"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>pe(s?.userData),className:`p-2 flex items-center justify-center ${a.textSecondary} rounded-lg ${a.activeBg} hover:scale-105 transition-all duration-200`,title:"View Client Details",children:e.jsx(De,{className:"w-4 h-4"})}),(s?.userData?.isOnboarded||s?.isOnboarded)&&e.jsx("button",{onClick:()=>{const n=s?.id||s?._id||s?.userData?.id||s?.userData?._id;u(`/dashboard/clients/${n}?tab=employees`,{state:{client:s}})},className:`p-2 flex items-center justify-center ${a.textSecondary} rounded-lg ${a.activeBg} hover:scale-105 transition-all duration-200`,title:"View AI Employee Analytics",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(s?.userData),className:`p-2 flex items-center justify-center ${a.textSecondary} rounded-lg ${a.activeBg} hover:scale-105 transition-all duration-200`,title:"Edit Client",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(s?.userData),className:"p-2 flex items-center justify-center text-red-500 rounded-lg hover:bg-red-50 hover:scale-105 transition-all duration-200",title:"Delete Client",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xs ${a.textSecondary} uppercase mb-0.5`,children:"Plan"}),e.jsx("p",{className:`${a.text} font-medium text-xs md:text-sm truncate`,children:(()=>{const n=s?.userData?.onboarding?.plan_type||s?.plan_details?.type,t=Q.find(r=>r.apiKey===n);return t?`${t.name} (${t.price})`:n||"No plan"})()})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs ${a.textSecondary} uppercase`,children:"Company"}),e.jsx("p",{className:`${a.text} font-medium text-sm`,children:s?.userData?.onboarding?.company_name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs ${a.textSecondary} uppercase`,children:"Email"}),e.jsx("p",{className:`${a.text} font-medium text-sm truncate`,children:s?.userData?.onboarding?.company_email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs ${a.textSecondary} uppercase`,children:"AI Employees"}),e.jsx("p",{className:`${a.text} font-medium text-sm`,children:s?.userData?.onboarding?.ai_employee_count||(s?.ai_employees||[]).length})]})]})]},s.id))}),g>1&&e.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 md:gap-3 mt-4 md:mt-6 p-3 md:p-4 rounded-lg ${a.searchBg}`,children:[e.jsxs("div",{className:`text-xs md:text-sm ${a.textSecondary} text-center sm:text-left`,children:["Showing"," ",((c?.page||l)-1)*(c?.limit||$)+1," ","to"," ",Math.min((c?.page||l)*(c?.limit||$),c?.total||S)," ","of ",c?.total||S]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:re,disabled:l===1,className:`px-2.5 md:px-3 py-1.5 text-xs md:text-sm rounded-md transition-all duration-200 ${l===1?`${a.textSecondary} cursor-not-allowed opacity-50`:`${a.text} ${a.hover} hover:scale-105`}`,children:"Previous"}),e.jsxs("span",{className:`mx-2 md:mx-3 text-xs md:text-sm ${a.text}`,children:[c?.page||l,"/",c?.totalPages||g]}),e.jsx("button",{onClick:le,disabled:l===g,className:`px-2.5 md:px-3 py-1.5 text-xs md:text-sm rounded-md transition-all duration-200 ${l===g?`${a.textSecondary} cursor-not-allowed opacity-50`:`${a.text} ${a.hover} hover:scale-105`}`,children:"Next"})]})]})]})]})};export{Je as AIEmployeesTab,Ae as AgentDetailsView,Xe as ClientDetailsTab,Ye as OnboardingDataTab,Ze as TransactionsTab,Ge as default};
