import{j as e,L as Q,u as X,s as v,z as g}from"./admin-BYNBOjnt.js";import{r as l,d as Y,u as ee,c as te}from"./router-C-JlvvJt.js";import{e as S,o as se,i as ae,p as _,q as ne,r as B,s as re,b as R,m as le,n as ie,t as oe,u as de,v as ce}from"./index-Dfj_MLPr.js";import{A as me,O as xe,C as ge,a as ue,T as be,D as he}from"./DeleteConfirmationModal--4gfFAkX.js";import"./vendor-DJG_os-6.js";import"./icons-Cy3jFTXJ.js";const M=({isOpen:u,onClose:c,onConfirm:m,title:$="Confirm Action",message:r="Are you sure you want to proceed?",description:n="",confirmText:t="Confirm",cancelText:j="Cancel",confirmButtonClass:N="",icon:b=null,iconContainerClass:C="",variant:I="default"})=>{const[p,w]=l.useState(!1);l.useEffect(()=>{u||w(!1)},[u]),l.useEffect(()=>{const x=f=>{f.key==="Escape"&&u&&!p&&c()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[u,p,c]),l.useEffect(()=>(u?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[u]);const D=async()=>{w(!0);try{await m()}finally{w(!1),c()}},A=()=>{if(N)return N;switch(I){case"danger":return"bg-red-600 hover:bg-red-700 text-white";case"success":return"bg-green-600 hover:bg-green-700 text-white";case"warning":return"bg-yellow-500 hover:bg-yellow-600 text-white";default:return"bg-gray-900 hover:bg-gray-800 text-white"}};return u?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:x=>{x.target===x.currentTarget&&!p&&c()},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in fade-in zoom-in-95 duration-200",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$}),e.jsx("button",{onClick:c,disabled:p,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-5",children:[b&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:`p-4 border border-gray-300 rounded-full ${C}`,children:b})}),e.jsx("p",{className:"text-center text-gray-700 mb-2",children:r}),n&&e.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:n})]}),e.jsxs("div",{className:"flex items-center gap-3 p-5 border-t border-gray-200",children:[e.jsx("button",{onClick:c,disabled:p,className:"flex-1 px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:j}),e.jsx("button",{onClick:D,disabled:p,className:`flex-1 px-4 py-2.5 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 ${A()}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):t})]})]})]}):null},Ne=()=>{const u=Y(),c=ee(),m=te(),{theme:$,currentTheme:r}=X(),n=u.clientId||u.id;if(console.log("üîç ClientId from URL params:",n),!n){const s=m.pathname.split("/"),a=s[s.length-1];console.log("üîç Path segments:",s),console.log("üîç Possible clientId from path:",a)}const[t,j]=l.useState(null),[N,b]=l.useState(!0),[C,I]=l.useState(null),[p,w]=l.useState("details"),[D,A]=l.useState(null),[x,f]=l.useState(null),[F,O]=l.useState(!1),[V,U]=l.useState(!1),[z,P]=l.useState(!1),h=l.useMemo(()=>{const s=t?.userData?.isOnboarded||t?.isOnboarded;return console.log("üéØ isOnboarded calculation:",{hasClient:!!t,userData_isOnboarded:t?.userData?.isOnboarded,client_isOnboarded:t?.isOnboarded,finalValue:s}),s||!1},[t?.userData?.isOnboarded,t?.isOnboarded]);l.useEffect(()=>{if(console.log("üéØ ClientDetailsPage mounted with clientId:",n),!n){console.error("‚ùå Critical Error: No clientId found in URL params"),f("Invalid URL - Client ID is missing"),b(!1);return}if(typeof n!="string"){console.error("‚ùå Critical Error: ClientId is not a string:",typeof n,n),f("Invalid Client ID format"),b(!1);return}if(n.length<3){console.error("‚ùå Critical Error: ClientId too short:",n,"Length:",n.length),f("Invalid Client ID - ID too short"),b(!1);return}if(!/^[a-zA-Z0-9_-]+$/.test(n)){console.error("‚ùå Critical Error: ClientId contains invalid characters:",n),f("Invalid Client ID - Contains invalid characters"),b(!1);return}console.log("‚úÖ ClientId validation passed:",n)},[n]);const y=l.useMemo(()=>{const s=[{id:"onboarding",label:"Onboarding Data",icon:se},{id:"details",label:"Client Details",icon:ae},{id:"employees",label:"AI Employees",icon:_},{id:"transactions",label:"Transactions",icon:ne}],a=h?s:s.filter(i=>i.id!=="onboarding");return console.log("üîç Tabs calculation:",{isOnboarded:h,allTabsCount:s.length,finalTabsCount:a.length,finalTabIds:a.map(i=>i.id),onboardingTabIncluded:a.some(i=>i.id==="onboarding")}),a},[h]),k=l.useCallback(()=>{const a=new URLSearchParams(m.search).get("tab");if(console.log("üéØ getInitialTab - tabFromUrl:",a,"isOnboarded:",h),a&&y.some(d=>d.id===a))return console.log("‚úÖ Using tab from URL:",a),a;const i=h?"onboarding":"details";return console.log("‚úÖ Using default tab:",i),i},[m.search,y,h]),[o,E]=l.useState(k);l.useEffect(()=>{const s=k();console.log("üéØ Tab update check - currentTab:",s,"activeTab:",o,"isOnboarded:",h),o==="onboarding"&&!h?(console.log("üîÑ Switching from onboarding to details (not onboarded)"),E("details")):y.some(a=>a.id===o)||(console.log("üîÑ Switching to valid tab:",s),E(s))},[h,y,k,o]),l.useEffect(()=>{if(new URLSearchParams(m.search).get("tab")!==o){const i=new URLSearchParams(m.search);i.set("tab",o);const d=`${m.pathname}?${i.toString()}`;window.location.href!==window.location.origin+d&&window.history.replaceState(m.state,"",d)}},[o,m.pathname,m.search,m.state]),l.useEffect(()=>{(async()=>{if(!n||typeof n!="string"||n.length<3){console.error("‚ùå Invalid clientId:",n),f("Invalid Client ID in URL"),b(!1);return}try{b(!0),f(null),console.log("üîç Fetching client by userId:",n);const a=await v.getClientByUserId(n);if(a?.data)console.log("‚úÖ Client data fetched:",a.data),j(a.data?.user);else if(a)console.log("‚úÖ Client data fetched:",a),j(a);else throw new Error("No client data returned")}catch(a){if(console.error("‚ùå Error fetching client:",a),a.response?.status===404)g.error("Client not found"),c("/dashboard/clients");else{const i=a.message||"Failed to load client details";f(i),g.error(i)}}finally{b(!1)}})()},[n,c]),l.useEffect(()=>{if(t){const s=t?.userData?.fullName||t?.company_basics?.name||"Client",a=y.find(i=>i.id===o)?.label||"Details";document.title=`${s} - ${a} | ShivAI Admin`}else document.title="Client Details | ShivAI Admin";return()=>{document.title="ShivAI Admin"}},[t,o]);const L=()=>{window.history.length>1?c(-1):c("/dashboard/clients")},q=s=>{g("Edit functionality coming soon",{icon:"‚ÑπÔ∏è",duration:3e3})},W=async()=>{try{let a=t?.onboarding?._id||t?.userData?.onboarding?._id||t?.onboardingDetails?.onboarding?._id;if(!a){const d=await v.getOnboardingByUserId(n);if(a=d?.data?.onboarding?._id||d?.onboarding?._id,!a){g.error("Could not find onboarding data to approve");return}}if((await v.approveClient(a))?.message==="Onboarding approved successfully"){g.success("Client approved successfully");try{const d=await v.getClientByUserId(n);d?.data?j(d.data):d&&j(d)}catch(d){console.warn("Could not refresh client data after approval:",d),j(K=>({...K,onboardingStatus:"approved"}))}}}catch(s){console.error("Error approving client:",s),g.error("Failed to approve client")}},Z=async()=>{try{let a=t?.onboarding?._id||t?.userData?.onboarding?._id||t?.onboardingDetails?.onboarding?._id;if(!a){const i=await v.getOnboardingByUserId(n);if(a=i?.data?.onboarding?._id||i?.onboarding?._id,!a){g.error("Could not find onboarding data to reject");return}}await v.rejectClient(a),g.success("Client rejected successfully"),c("/dashboard/clients")}catch(s){console.error("Error rejecting client:",s),g.error("Failed to reject client")}},G=async()=>{try{await v.deleteUser(n),g.success("Client deleted successfully"),c("/dashboard/clients")}catch(s){console.error("Error deleting client:",s),g.error("Failed to delete client")}},H=s=>{console.log("View agent:",s),A(o),I(s),w("agentView")},J=()=>{I(null),w("details"),D&&(E(D),A(null))};if(console.log("üîç ClientDetailsPage - isOnboarded:",h),console.log("üîç ClientDetailsPage - Tabs to display:",y.map(s=>s.id)),console.log("üîç ClientDetailsPage - Current active tab:",o),N)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!t&&!N&&x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:x.includes("Network")?"Connection Error":"Error Loading Client"}),e.jsx("p",{className:"text-gray-600 mb-4",children:x}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Try Again"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors",children:"Back to Clients"})]})]})});if(!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Client Not Found"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Back to Clients"})]})});if(p==="agentView"&&C)return e.jsx(me,{agent:C,onBack:J,currentTheme:r});const T={totalAIEmployees:t?.ai_employees?.length||0,liveAIEmployees:t?.ai_employees?.filter(s=>s.status==="active")?.length||0,totalCalls:0,totalRevenue:0,isActive:t?.isApproved||!1};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`${r.cardBg} border ${r.border} rounded-lg p-3 md:p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3",children:[e.jsx("button",{onClick:L,className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(re,{className:"w-4 h-4 md:w-5 md:h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-lg md:text-xl font-semibold ${r.text}`,children:t?.fullName||t?.company_basics?.name||"Client Details"}),e.jsx("p",{className:`text-xs md:text-sm ${r.textSecondary}`,children:t?.email||t?.company_basics?.company_email||""})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 md:space-x-2",children:[(t?.userData?.isOnboarded||t?.isOnboarded)&&t?.onboardingStatus!=="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>O(!0),className:"p-1.5 md:p-2 hover:bg-green-50 rounded-lg transition-colors",title:"Accept Client",children:e.jsx(R,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-green-600"})}),e.jsx("button",{onClick:()=>U(!0),className:"p-1.5 md:p-2 hover:bg-red-50 rounded-lg transition-colors",title:"Reject Client",children:e.jsx(S,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-red-600"})})]}),t?.onboardingStatus==="approved"&&e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 md:px-3 md:py-1.5 border border-gray-200 text-gray-700 rounded-lg text-xs md:text-sm font-medium",children:[e.jsx(R,{className:"w-3 h-3 md:w-4 md:h-4"}),e.jsx("span",{children:"Approved"})]}),e.jsx("button",{onClick:()=>q(),className:"p-1.5 md:p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit Client",children:e.jsx(le,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>P(!0),className:"p-1.5 md:p-2 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Client",children:e.jsx(ie,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-red-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsx("div",{className:`${r.cardBg} border ${r.border} rounded-lg p-3 md:p-4`,children:e.jsxs("div",{className:"flex items-start space-x-2 md:space-x-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 border border-gray-200 rounded-lg",children:e.jsx(_,{className:"w-4 h-4 md:w-5 md:h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-lg md:text-xl font-bold ${r.text} leading-none`,children:T.totalAIEmployees}),e.jsx("p",{className:`text-xs md:text-sm ${r.textSecondary} truncate`,children:"AI Employees"})]})]})}),e.jsx("div",{className:`${r.cardBg} border ${r.border} rounded-lg p-3 md:p-4`,children:e.jsxs("div",{className:"flex items-start space-x-2 md:space-x-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 border border-gray-200 rounded-lg",children:e.jsx(oe,{className:"w-4 h-4 md:w-5 md:h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-lg md:text-xl font-bold ${r.text} leading-none`,children:T.liveAIEmployees}),e.jsx("p",{className:`text-xs md:text-sm ${r.textSecondary} truncate`,children:"Active Now"})]})]})}),e.jsx("div",{className:`${r.cardBg} border ${r.border} rounded-lg p-3 md:p-4`,children:e.jsxs("div",{className:"flex items-start space-x-2 md:space-x-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 border border-gray-200 rounded-lg",children:e.jsx(de,{className:"w-4 h-4 md:w-5 md:h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-lg md:text-xl font-bold ${r.text} leading-none`,children:T.totalCalls}),e.jsx("p",{className:`text-xs md:text-sm ${r.textSecondary} truncate`,children:"Total Calls"})]})]})}),e.jsx("div",{className:`${r.cardBg} border ${r.border} rounded-lg p-3 md:p-4`,children:e.jsxs("div",{className:"flex items-start space-x-2 md:space-x-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 border border-gray-200 rounded-lg",children:e.jsx(ce,{className:"w-4 h-4 md:w-5 md:h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:`text-lg md:text-xl font-bold ${r.text} leading-none`,children:["$",T.totalRevenue.toLocaleString()]}),e.jsx("p",{className:`text-xs md:text-sm ${r.textSecondary} truncate`,children:"Revenue"})]})]})})]}),e.jsxs("div",{className:`${r.cardBg} border ${r.border} rounded-lg`,children:[e.jsx("div",{className:"border-b border-gray-200 px-2 md:px-4",children:e.jsx("div",{className:"flex  space-x-2 md:space-x-4 overflow-x-auto scrollbar-hide",children:y.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>E(s.id),className:`flex items-center space-x-1 md:space-x-2 px-2 md:px-4 py-3 md:py-3 text-[13px] lg:text-[16px] md:text-sm font-medium border-b-2 whitespace-nowrap ${o===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(a,{className:"w-4 h-4 md:w-4 md:h-4"}),e.jsx("span",{children:s.label})]},s.id)})})}),e.jsxs("div",{className:"p-3 md:p-6",children:[e.jsx("div",{className:o==="onboarding"?"block":"hidden",children:e.jsx(xe,{client:t,currentTheme:r,clientId:n})}),e.jsx("div",{className:o==="details"?"block":"hidden",children:e.jsx(ge,{client:t,currentTheme:r,clientId:n})}),e.jsx("div",{className:o==="employees"?"block":"hidden",children:e.jsx(ue,{client:t,currentTheme:r,onViewAgent:H,clientId:n})}),e.jsx("div",{className:o==="transactions"?"block":"hidden",children:e.jsx(be,{client:t,currentTheme:r,clientId:n})})]})]}),e.jsx(M,{isOpen:F,onClose:()=>O(!1),onConfirm:W,title:"Approve Client",message:`Are you sure you want to approve "${t?.userData?.fullName||t?.fullName||t?.email||"this client"}"?`,description:"This will grant the client access to all approved features and services.",confirmText:"Approve",variant:"success",icon:e.jsx(R,{className:"w-12 h-12 text-green-500"})}),e.jsx(M,{isOpen:V,onClose:()=>U(!1),onConfirm:Z,title:"Reject Client",message:`Are you sure you want to reject "${t?.userData?.fullName||t?.fullName||t?.email||"this client"}"?`,description:"The client will be notified of the rejection and will need to reapply.",confirmText:"Reject",variant:"danger",icon:e.jsx(S,{className:"w-12 h-12 text-red-500"})}),e.jsx(he,{isOpen:z,onClose:()=>P(!1),onConfirm:G,title:"Delete Client",itemName:t?.userData?.fullName||t?.fullName||t?.email||"",itemType:"client",warningMessage:"All associated data including AI employees, transactions, and settings will be permanently deleted."})]})};export{Ne as default};
