import{u as U,j as e,s as u,z as m}from"./admin-DPoVIZhb.js";import{c as V,u as M,d as z,r as l}from"./router-CINeAvhf.js";import{R as W,a as q,b as E,c as G,d as H,e as J,f as R,g as K,h as Q,i as X,j as Y,k as Z,l as ee}from"./index-BzqZcpCQ.js";import{AgentDetailsView as te,OnboardingDataTab as se,ClientDetailsTab as ae,AIEmployeesTab as ne,TransactionsTab as le}from"./ClientManagement-Bf3LE6XE.js";import"./vendor-DJG_os-6.js";import"./icons-DnVO2Lau.js";const he=()=>{const{clientId:p}=V(),c=M(),i=z(),{theme:ie,currentTheme:t}=U(),[s,g]=l.useState(i.state?.client||null),[I,x]=l.useState(!i.state?.client),[v,y]=l.useState(null),[k,N]=l.useState("details"),[w,$]=l.useState(null),h=l.useMemo(()=>s?.userData?.isOnboarded||s?.isOnboarded||!1,[s?.userData?.isOnboarded,s?.isOnboarded]),[C,D]=l.useState(null),[re,j]=l.useState(null);l.useEffect(()=>{(async()=>{const n=s?.userData?._id||s?._id||s?.userData?.id||s?.id;if(!n){console.warn("âš ï¸ No user ID found for fetching onboarding data"),x(!1);return}try{x(!0),j(null),console.log("ðŸ” Fetching onboarding data for user ID:",n);const r=await u.getOnboardingByUserId(n);console.log("âœ… Onboarding data fetched:",r);const d=r?.data?.onboarding||r?.onboarding||r?.data||r;D(d)}catch(r){console.error("âŒ Error fetching onboarding data:",r),j(r.message||"Failed to load onboarding data");const d=s?.onboardingDetails?.onboarding||s?.userData?.onboarding||s?.onboarding||{};d&&Object.keys(d).length>0&&(console.log("ðŸ“‹ Using fallback onboarding data from client prop"),D(d),j(null))}finally{x(!1)}})()},[s]);const b=l.useMemo(()=>{const a=[{id:"onboarding",label:"Onboarding Data",icon:W},{id:"details",label:"Client Details",icon:q},{id:"employees",label:"AI Employees",icon:E},{id:"transactions",label:"Transactions",icon:G}];return h?a:a.filter(n=>n.id!=="onboarding")},[h]),L=l.useCallback(()=>{const n=new URLSearchParams(i.search).get("tab");return n&&b.some(r=>r.id===n)?n:h?"onboarding":"details"},[i.search,b,h]),[o,S]=l.useState(L);l.useEffect(()=>{const a=new URLSearchParams(i.search);a.get("tab")!==o&&(a.set("tab",o),c(`${i.pathname}?${a.toString()}`,{replace:!0,state:i.state}))},[o,c,i.pathname,i.search,i.state]),l.useEffect(()=>{p&&(async()=>{if(i.state?.client){console.log("âœ… Client data received from navigation state:",i.state.client),g(i.state.client),x(!1);return}try{x(!0);const n=await u.getClientById(p);console.log("âœ… Client data fetched from API:",n),n?.success&&n?.data?g(n.data):(m.error("Client not found"),c("/dashboard/clients"))}catch(n){console.error("âŒ Error fetching client:",n),m.error("Failed to load client details"),c("/dashboard/clients")}finally{x(!1)}})()},[p,c,i.state]),l.useEffect(()=>{if(s){const a=s?.userData?.fullName||s?.company_basics?.name||"Client",n=b.find(r=>r.id===o)?.label||"Details";document.title=`${a} - ${n} | ShivAI Admin`}else document.title="Client Details | ShivAI Admin";return()=>{document.title="ShivAI Admin"}},[s,o]);const A=()=>{window.history.length>1?c(-1):c("/dashboard/clients")},T=a=>{m("Edit functionality coming soon",{icon:"â„¹ï¸",duration:3e3})},O=async a=>{if(window.confirm(`Are you sure you want to delete ${a?.userData?.fullName||"this client"}?`))try{await u.deleteClient(a?._id),m.success("Client deleted successfully"),c("/dashboard/clients")}catch(n){console.error("Error deleting client:",n),m.error("Failed to delete client")}},_=async a=>{console.log(a,"jj");try{if((await u.approveClient(C?._id))?.message==="Onboarding approved successfully"){m.success("Client approved successfully");const r={...a,onboardingStatus:"approved",userData:{...a.userData,isOnboarded:!0}};g(r);const d=await u.getClientById(p);d?.success&&d?.data&&g(d.data)}}catch(n){console.error("Error approving client:",n),m.error("Failed to approve client")}},B=async a=>{try{await u.rejectClient(C?._id),m.success("Client rejected successfully"),c("/dashboard/clients")}catch(n){console.error("Error rejecting client:",n),m.error("Failed to reject client")}},P=a=>{console.log("View agent:",a),$(o),y(a),N("agentView")},F=()=>{y(null),N("details"),w&&(S(w),$(null))};if(console.log("ðŸ” ClientDetailsPage - isOnboarded:",h),console.log("ðŸ” ClientDetailsPage - Tabs to display:",b.map(a=>a.id)),console.log("ðŸ” ClientDetailsPage - Current active tab:",o),I)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Client Not Found"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Back to Clients"})]})});if(k==="agentView"&&v)return e.jsx(te,{agent:v,onBack:F,currentTheme:t});const f={totalAIEmployees:s?.ai_employees?.length||0,liveAIEmployees:s?.ai_employees?.filter(a=>a.status==="active")?.length||0,totalCalls:0,totalRevenue:0,isActive:s?.isApproved||!1};return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:gap-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 min-w-0 flex-1",children:[e.jsx("button",{onClick:A,className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200 flex-shrink-0 mt-1`,children:e.jsx(J,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:`text-xl sm:text-2xl font-bold ${t.text} truncate`,children:s?.fullName||s?.company_basics?.name||"Client Details"}),e.jsx("p",{className:`text-sm ${t.textSecondary} truncate mt-1`,children:s?.email||s?.company_basics?.company_email||""})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(s?.userData?.isOnboarded||s?.isOnboarded)&&s?.onboardingStatus!=="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(s),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Accept Client",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>B(),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Reject Client",children:e.jsx(K,{className:"w-5 h-5"})})]}),s?.onboardingStatus==="approved"&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:"Approved"})]}),e.jsx("button",{onClick:()=>T(),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Edit Client",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>O(s),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Delete Client",children:e.jsx(X,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(E,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:f.totalAIEmployees}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"AI Employees"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Y,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:f.liveAIEmployees}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Active Now"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Z,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:f.totalCalls}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Total Calls"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ee,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsxs("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:["$",f.totalRevenue.toLocaleString()]}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Revenue"})]})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl shadow-lg`,children:[e.jsx("div",{className:`border-b ${t.border} px-4 md:px-6`,children:e.jsx("div",{className:"flex gap-1 md:gap-2 overflow-x-auto scrollbar-hide -mb-px",children:b.map(a=>{const n=a.icon;return e.jsxs("button",{onClick:()=>S(a.id),className:`flex items-center gap-2 px-3 md:px-4 py-3 md:py-4 text-sm font-medium border-b-2 transition-all duration-200 whitespace-nowrap ${o===a.id?`border-blue-500 ${t.text}`:`border-transparent ${t.textSecondary} hover:${t.text}`}`,children:[e.jsx(n,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:a.label})]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[o==="onboarding"&&e.jsx(se,{client:s,currentTheme:t},`onboarding-${s?._id}`),o==="details"&&e.jsx(ae,{client:s,currentTheme:t},`details-${s?._id}`),o==="employees"&&e.jsx(ne,{client:s,currentTheme:t,onViewAgent:P},`employees-${s?._id}-${o}`),o==="transactions"&&e.jsx(le,{client:s,currentTheme:t},`transactions-${s?._id}`)]})]})]})};export{he as default};
