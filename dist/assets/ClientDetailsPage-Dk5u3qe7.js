import{u as B,j as e,s as u,z as c}from"./admin-BCOmTk6B.js";import{c as _,u as F,d as O,r}from"./router-CINeAvhf.js";import{R as V,a as U,b as C,c as M,d as z,e as W,f as A,g as q,h as G,i as H,j as J,k as K,l as Q}from"./index-BzqZcpCQ.js";import{AgentDetailsView as X,OnboardingDataTab as Y,ClientDetailsTab as Z,AIEmployeesTab as ee,TransactionsTab as te}from"./ClientManagement-DfUdEeQr.js";import"./vendor-DJG_os-6.js";import"./icons-DnVO2Lau.js";const ce=()=>{const{clientId:d}=_(),o=F(),l=O(),{theme:se,currentTheme:t}=B(),[s,p]=r.useState(l.state?.client||null),[S,b]=r.useState(!l.state?.client),[f,j]=r.useState(null),[D,v]=r.useState("details"),[N,y]=r.useState(null),m=r.useMemo(()=>s?.userData?.isOnboarded||s?.isOnboarded||!1,[s?.userData?.isOnboarded,s?.isOnboarded]),x=r.useMemo(()=>{const a=[{id:"onboarding",label:"Onboarding Data",icon:V},{id:"details",label:"Client Details",icon:U},{id:"employees",label:"AI Employees",icon:C},{id:"transactions",label:"Transactions",icon:M}];return m?a:a.filter(n=>n.id!=="onboarding")},[m]),R=r.useCallback(()=>{const n=new URLSearchParams(l.search).get("tab");return n&&x.some(g=>g.id===n)?n:m?"onboarding":"details"},[l.search,x,m]),[i,$]=r.useState(R);r.useEffect(()=>{const a=new URLSearchParams(l.search);a.get("tab")!==i&&(a.set("tab",i),o(`${l.pathname}?${a.toString()}`,{replace:!0,state:l.state}))},[i,o,l.pathname,l.search,l.state]),r.useEffect(()=>{d&&(async()=>{if(l.state?.client){console.log("âœ… Client data received from navigation state:",l.state.client),p(l.state.client),b(!1);return}try{b(!0),console.log("ðŸ”„ Fetching client details from API for ID:",d);const n=await u.getClientById(d);console.log("âœ… Client data fetched from API:",n),n?.success&&n?.data?p(n.data):(c.error("Client not found"),o("/dashboard/clients"))}catch(n){console.error("âŒ Error fetching client:",n),c.error("Failed to load client details"),o("/dashboard/clients")}finally{b(!1)}})()},[d,o,l.state]),r.useEffect(()=>{if(s){const a=s?.userData?.fullName||s?.company_basics?.name||"Client",n=x.find(g=>g.id===i)?.label||"Details";document.title=`${a} - ${n} | ShivAI Admin`}else document.title="Client Details | ShivAI Admin";return()=>{document.title="ShivAI Admin"}},[s,i]);const w=()=>{window.history.length>1?o(-1):o("/dashboard/clients")},E=a=>{c("Edit functionality coming soon",{icon:"â„¹ï¸",duration:3e3})},I=async a=>{if(window.confirm(`Are you sure you want to delete ${a?.userData?.fullName||"this client"}?`))try{await u.deleteClient(a?._id),c.success("Client deleted successfully"),o("/dashboard/clients")}catch(n){console.error("Error deleting client:",n),c.error("Failed to delete client")}},L=async a=>{try{await u.approveClient(a?._id),c.success("Client approved successfully");const n=await u.getClientById(d);n?.success&&n?.data&&p(n.data)}catch(n){console.error("Error approving client:",n),c.error("Failed to approve client")}},T=async a=>{try{await u.rejectClient(a?._id),c.success("Client rejected successfully"),o("/dashboard/clients")}catch(n){console.error("Error rejecting client:",n),c.error("Failed to reject client")}},k=a=>{console.log("View agent:",a),y(i),j(a),v("agentView")},P=()=>{j(null),v("details"),N&&($(N),y(null))};if(console.log("ðŸ” ClientDetailsPage - isOnboarded:",m),console.log("ðŸ” ClientDetailsPage - Tabs to display:",x.map(a=>a.id)),console.log("ðŸ” ClientDetailsPage - Current active tab:",i),S)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Client Not Found"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Back to Clients"})]})});if(D==="agentView"&&f)return e.jsx(X,{agent:f,onBack:P,currentTheme:t});const h={totalAIEmployees:s?.ai_employees?.length||0,liveAIEmployees:s?.ai_employees?.filter(a=>a.status==="active")?.length||0,totalCalls:0,totalRevenue:0,isActive:s?.isApproved||!1};return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:gap-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 min-w-0 flex-1",children:[e.jsx("button",{onClick:w,className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200 flex-shrink-0 mt-1`,children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:`text-xl sm:text-2xl font-bold ${t.text} truncate`,children:s?.fullName||s?.company_basics?.name||"Client Details"}),e.jsx("p",{className:`text-sm ${t.textSecondary} truncate mt-1`,children:s?.email||s?.company_basics?.company_email||""})]})]}),console.log("ðŸ” Rendering action buttons for client:",s),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(s?.userData?.isOnboarded||s?.isOnboarded)&&s?.onboardingStatus!=="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>L(s),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Accept Client",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T(s),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Reject Client",children:e.jsx(q,{className:"w-5 h-5"})})]}),s?.onboardingStatus==="approved"&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm font-medium",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Approved"})]}),e.jsx("button",{onClick:()=>E(),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Edit Client",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>I(s),className:`p-2 rounded-lg ${t.hover} ${t.text} transition-all duration-200`,title:"Delete Client",children:e.jsx(H,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(C,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:h.totalAIEmployees}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"AI Employees"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(J,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:h.liveAIEmployees}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Active Now"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(K,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:h.totalCalls}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Total Calls"})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl p-3 md:p-4`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Q,{className:`w-5 h-5 ${t.textSecondary}`})}),e.jsxs("p",{className:`text-2xl md:text-3xl font-bold ${t.text}`,children:["$",h.totalRevenue.toLocaleString()]}),e.jsx("p",{className:`text-xs ${t.textSecondary} mt-1`,children:"Revenue"})]})]}),e.jsxs("div",{className:`${t.cardBg} border ${t.border} rounded-xl shadow-lg`,children:[e.jsx("div",{className:`border-b ${t.border} px-4 md:px-6`,children:e.jsx("div",{className:"flex gap-1 md:gap-2 overflow-x-auto scrollbar-hide -mb-px",children:x.map(a=>{const n=a.icon;return e.jsxs("button",{onClick:()=>$(a.id),className:`flex items-center gap-2 px-3 md:px-4 py-3 md:py-4 text-sm font-medium border-b-2 transition-all duration-200 whitespace-nowrap ${i===a.id?`border-blue-500 ${t.text}`:`border-transparent ${t.textSecondary} hover:${t.text}`}`,children:[e.jsx(n,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:a.label})]},a.id)})})}),e.jsxs("div",{className:"p-6",children:[i==="onboarding"&&e.jsx(Y,{client:s,currentTheme:t},`onboarding-${s?._id}`),i==="details"&&e.jsx(Z,{client:s,currentTheme:t},`details-${s?._id}`),i==="employees"&&e.jsx(ee,{client:s,currentTheme:t,onViewAgent:k},`employees-${s?._id}-${i}`),i==="transactions"&&e.jsx(te,{client:s,currentTheme:t},`transactions-${s?._id}`)]})]})]})};export{ce as default};
